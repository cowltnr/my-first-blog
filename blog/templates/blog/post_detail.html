{% extends 'blog/base.html' %}
{% load embed_video_tags %}
{% load static %}

{% for post in posts %}
<div>
    <div>
        <p>{{ post.title }}</p>
        <p>{{ post.content }}</p>
    </div>
</div>
{% endfor %}

{% block content %}
    <div class="post">
        {% if post.published_date %}
            <div class="date">
                {{ post.published_date }}
            </div>
        {% endif %}

        {% if user.is_authenticated %}
            <a class="btn btn-default" href="{% url 'post_edit' pk=post.pk %}">
                <span class="glyphicon glyphicon-pencil"></span>
            </a>
        {% endif %}

        <h1>{{ post.title }}</h1>
        <p>{{ post.text|linebreaksbr }}</p>

        {% if post.img %}
            <img src="{{ post.img.url }}" alt="connect" style="max-height:300px">
        {% endif %}

        {% if post.video %}
            <div class="iframe-container">
                <div id="player"></div>
            </div>




            <script src="https://www.youtube.com/iframe_api"></script>
            <script>
            url="{{ post.video }}"
            videoiddd=extractVideoId(url)


             function extractVideoId(url) {
                    var match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w-]{11})/);
                    return (match && match[1]) || null;
                }

                var player;

                function onYouTubeIframeAPIReady() {
                    player = new YT.Player('player', {
                        height: '360',
                        width: '640',
                        videoId : videoiddd,
                        playerVars: {
                            'autoplay': 1
                        },
                        events: {
                            'onReady': onPlayerReady,
                            'onStateChange': onPlayerStateChange
                        }
                    });
                }

                function onPlayerReady(event) {
                    console.log('동영상 재생 준비 완료');
                }

                function onPlayerStateChange(event) {
                    if (event.data == YT.PlayerState.ENDED) {
                        console.log('동영상이 종료되었습니다.');
                    }
                }

                function playVideo() {
                    var videoLink = document.getElementById('videoLink').value;
                    var videoId = extractVideoId(videoLink);

                    if (videoId) {
                        player.loadVideoById(videoId);
                    }
                }


            </script>
        {% endif %}
    </div>

    <style>
        /* Make the youtube video responsive */
        .iframe-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
        }

        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
{% endblock %}
